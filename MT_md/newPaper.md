---
title: "Planar Quads for Architecture Surfaces"
date: "September 2018"
author: "Christian Dimitri, UPC BarcelonaTech"
abstract:
    This chapter will discuss briefly the state of the art related to the Planar Quads Meshes, and how they are implemented in architecture. Therefore we will show the solutions behind the available softwares and the different algorithms related to variantes researches achieved within this topic in the last twenty years. In addition to that we will try to cover those techniques, by implementing them using the available tools. In the end the results will be analyzed regarding the economical and aesthetical properties for constructable planar quadrilateral panels.
bibliography: paper.bib
---

# State Of The Art:

## Architecture Implmentations
Roof over the Rostock courtyard (@fig:Rostockroof) in Germany [@glymph2004parametric], realized with different parabolas translated as generatrix and directrix see also (@fig:EllipticalParaboloid). The resulting elliptic curves are generated perpendicular one to another and evenly meshed net that consists of planar quad glass panels. 

![Rostock courtyard glass roof.](MT_JPG/Rostock roof.jpg){#fig:Rostockroof}

Roof over the Bosch Areal courtyards (@fig:BoschRoof) [@glymph2004parametric] - Grid dome generated by  translation over the respective paths. The resulting mesh is a PQ mesh made of glass.

![Bosch areal courtyards glass roof.](MT_JPG/BoschRoof.jpg){#fig:BoschRoof}

*Railway station by B.Schneider* [@liu2006geometric], made of conical meshes which discretize the curvature lines (@fig:Railwaystation right), possess a constant offset distance (@fig:Railwaystation left) and are connected by planar elements see the implementation on a railway station by B. Schneider

![*Railway station by B.Schneider*.](MT_JPG/ConicalMeshes.jpg){#fig:Railwaystation}

*The Yas Marina Hotel, Abu Dhabi by Zahad Hadid Architects* [@zadravec2010designing], *Asymptotic curves affected by the dominance of negative curvature which are the consequences of a free-form surface*. (@fig:YasHotel)

![*The Yas Marina Hotel, Abu Dhabi by Zahad Hadid Architects*.](MT_JPG/YasIslandAbuDhabiGoldenTreasureTourism.jpg){#fig:YasHotel}

*The Opus project by Zaha Hadid Architects* [@zadravec2010designing], realized after modelling a coarse mesh, planarizing the quads, and applying a quad based subdivision algorithm in order to reach the desired smooth effect, see also for more information on subdivision (@fig:subdivided).

![*The Opus project by Zaha Hadid Architects*.](MT_JPG/OpusNight.jpg){#fig:OpusNight}

*A design study has been made for the courtyard roof of Neumunster monastery in Luxembourg*, the existing roof is a mix of triangular and quadrilateral. The resulting mesh is the consequence of neglecting the principale curvatures directions.

![*Neumunster monastery in Luxembourg*](MT_JPG/rfr_477_luxembourg_neumunster_009.jpg){#fig:NeumunsterRoof}

Therefore this study by [@zadravec2010designing], shows the results of there algorithm for the design of a quad dominant mesh with planar faces applied on the initial surface regarding the existing roof see (@fig:OptimizationNeumunster).

![Quad generation over the Neumunster roof and PQ optimization sequence with different side conditions](MT_JPG/OptimizationNeumunster.jpg){#fig:OptimizationNeumunster}



## Software Tools:

### CATIA [@glymph2004parametric]

### Rhino:

#### Evolute

#### Grasshopper:
##### GH_Kangaroo 
##### GH_Capybara 
##### GH_Millipede [@Millipede]

# What are Planar Quad Meshes ?

## PQ strips are:

* Single row of quadrilateral faces
* Discrete model of developable surfaces,
* Patches of the tangent surface of a polyline $\mathbf{r}_{1},\mathbf{r}_{2}$ which are rulings of the discrete tangents,
* ${a_{i},b_{i}}$ intersect in a point $\mathbf{r}_{i+1}$,
* As a developable surface are part of the tangent space of a surface, the planar faces of the PQ strip are represented as the planes of the developable surface, as seen in [@fig:PQStrips]. a)
  
![(a) PQ Strip (b) PQ Mesh ](MT_JPG/PQ Strips.jpg){#fig:PQStrips}

## PQ Meshes are:

* Vertices $\mathbf{v}_{i,j}$ ($j=k,k+1$) with a valence  $\pm k/4 (k\in Z)$
* n-geons appiration with $n \neq 4$ treated as singularities.
* The envelope along a curve of family A is a developable surface whose ruiling are curves of family B
* Each row of faces $\mathbf{v}_{i,j}$ is a PQ Strip 
* The row of vertices $\mathbf{v}_{0,k},..., \mathbf{v}_{n,k}$ forms the ruilings spanned between the vertices $\mathbf{v}_{i,k},..., \mathbf{v}_{i,k+1}$, and is the polylines of tangency between the mesh and the developable surface. 
* The column vertices as well
* System of rows and columns are discrete conjugate network of polylines, as seen in [@fig:PQStrips]. b)

## Planar Quad Constraints:

Geometric Principales

* Two parallel vectors in space enclosed at each point by two other vectors not necesseraly parallel forming a planar face. [@fig:PQquads] [@glymph2004parametric]
  
![Basic geometric principale for planar quads](MT_JPG/BasicGeometricPrincipaleForPlanarQuads.jpg){#fig:PQquads}

Convex and Planar: [@liu2006geometric]

>$$f_{Planarity}= \large{\sum_{\alpha_{i}}} -2\pi=0$$

Maximum angle difference: [@liu2006geometric]

>$$\delta=\max\large{\sum_{\alpha_{i}}} -2\pi$$

Warping Angles

The vectors detoned along each edges of the quad is perp to the normal vector to the surface $$|\mathbf{v}_{i,j}| \perp \mathbf{n}_{i}$$

XXXX

# The Algorithms Behind PQ meshes

## Planar Quads for Translation Surfaces

### What Are Translational Surfaces ?

* Admit a huge variety of shapes for a gridshell of quadrangular planar mesh.[@glymph2004parametric]
* If the sectional curves are plane and the vectors are parallel with same length the result will respond to the design principale of a translation surface.
* Assuming that one direction of the quad mesh net to be the sectional curve, two design principales can appear:
    * The row of longitudinal sectional curves form parallel vectors [@fig:PQquads]. a).
    * The row of lateral sectional curves form parallel vectors [@fig:PQquads]. b).

### Process

#### Translation Surfaces

##### Row of longitudinal sectional curves form parallel vectors

* A spatial curve called directrix is translated against another random spatial curve called directrix as seen in [@fig:TranslationPrincipales].
  
![Geometric principale for translation surfaces](MT_JPG/GeometricPrincipaleForTranslationSurfaces.JPG){#fig:TranslationPrincipales}

* Example of such surfaces:
  
    * Elliptical paraboloid:
  
    ![Elliptical paraboloid](MT_JPG/Ellipticalparaboloid.jpg){#fig:EllipticalParaboloid}

    * Hyperbolic paraboloid:
    
    ![Hyberbolic paraboloid](MT_JPG/Hyberbolic paraboloid.JPG){#fig:HyberbolicParaboloid}
    
    * Joining possiblities:

![Paraboloid joining possibilities ](MT_JPG/Joining possibilities Paraboloid.jpg){#fig:ParaJoin}


![Hyberbolic paraboloid joining possibilities ](MT_JPG/Hyberbolic paraboloid joining.jpg){#fig:HyparJoin}   


##### Row of lateral sectional curves form parallel vectors


![Lateral Row of sectional cuves and the reduction of longitudinal edges by introducing a triangular element](MT_JPG/Lateral Row.jpg){#fig:LateralRow}


#### Scale-Translation Surfaces

![Centric and excentric expansions](MT_JPG/Centric and excentric.jpg){#fig:CentExcent}

![Expansion and Translation](MT_JPG/Expansion and translation.jpg){#fig:ExpTrans}

![Resulting surface from an Expansion and Translation](MT_JPG/Resulting surface from an Expansion and Translation.jpg){#fig:ResultingSurface}

### Advantages of Translation Surfaces for the constructability of PQ meshes

* Planar 100%:
    * Proof: As describe in the planarity measure, the geometric principale of translational surfaces allows to succeed an ultimate planarity result on the panels.

* Homogeneous:
    * Proof: Another translational surfaces geometric principale is where the two parallel vectors enclosed by two others having the same length, reduces the variances between the panels.

## Conical Meshes:

* Conical meshes are planar quad meshes which discretize principal curvature lines, posses an offset at a constant distance as well as planar connecting elements. See [@fig:Railwaystation, @fig:ConicalMeshes],
* A conical mesh is conical if and only if all of its vertices $\mathbf{v}_{i}$ are conical.

![Faces Configuration of a Conical Ceshes](MT_JPG/facesConfiguration.jpg){#fig:facesConfiguration}



* $\mathbf{v}$ is a conical vertex if and only if the four face planes meeting at $\mathbf{v}$ are tangent to a common sphere [@liu2006geometric] see [@fig:facesConfiguration] (a) and (b)

#### The Angle Criterion of a Conical Mesh 

* The sum of the opposite angles on a vertex $\mathbf{v}$ should always be equals to zero so:
* $\mathbf{v}$ is a conical vertex if and only if the charaterization of a conical mesh interior angles should respond to this function: $$\omega_{1}+\omega_{3}=\omega_{2}+\omega_{4}$$

#### The Offset Properties,

* Triangular meshes are missing the the offset property at a constant distance. 
* However conical meshes have this property while generating conical meshes at the offset. 
* The fact that the faces of a conical mesh are incident to a common vertex $\mathbf{v}_{i,j}$ and tangent to a cone with an axis $Q_{i,j}$. After offseting the axis remains the same and the faces are still tangent to the cone.

![Constant offset of a Conical Mesh see [@pottmann-2008-fg]](MT_JPG/Constant Offset of Conical Meshes.jpg){#fig:ConicalMeshes} 

The Languerre transformation [@liu2006geometric] contains one of the instances for offsetting planes by a fixed distance along their normal vector. The Languerre transformation preserves the conical meshes at the offset.

#### The Normals,

* *The spherical image* is a fact where the vertice $\mathbf{n}_{ij}$ of a PQ mesh built on a unit sphere are converted to the normal vectors of $Q_{i,j}$.
* As the four faces incident to a common vertice $\mathbf{n}_{ij}$ tangent to the same cone $\Gamma_{ij}$, the normal vectors $\overrightarrow{n_{ij}}$ on each of the four faces share the same angle  with the cone's axis $Q_{i,j}$.
* Consequently the spherical image of the principale curvature network returns an orthogonal curve network on a sphere.

### The relation between PQ meshes and Conjugate Networks:[@liu2006geometric]

A symmetrical behaviour between conjugate directions: *If $\Gamma$ is the developable surface enveloped by the tangent planes along a curve $c\subset\Phi$ and $T_{1}$ is a a ruling of $\Gamma$ passing threw a point $p\in\Phi$ then the line $T_{2}$ tangent to the curve $c$ at the point $p$ is conjugate to $T_{1}$*
Asymptotic directions are self conjugate and such directions and bad for PQ meshes.
Conjugate curve networks are two one-parameter families of curves $A, B\subset\Phi$:
For each $p\in\Phi$ unique curves of both family $A, B$ should appear. Since $T_{1},T_{2}$ are conjugate then they predefine $A$ and get $B$ by *integrating the vector field directions conjugate of family $A$*

#### Examples of Conjugate Curve Networks on Surfaces.[@liu2006geometric]
* Well suited for PQ meshes:
    * *The network of principale curvature lines*
    * In a translational surface of the form $p(u,v)=\mathbf{q}(u)+\mathbf{q}(v)$ where its directrix curve $\mathbf{q}(u)$ is translated along a another curve generatrix $\mathbf{q}(v)$ and vice versa see (@fig:conjugateNetworks left).
* Not suited for PQ meshes:
    * *Epipolar curves*: The translation of a point $p$ along a line $l$ and the intersection of the planes threw the points $p(i)$ with that surface$\Phi$ generate asymptotic curves that are not suited for such meshing see (@fig:conjugateNetworks center).
    * *Isophotic curves are conjugate to the system of the steepest descent curves with respect to the z-axis* see (@fig:conjugateNetworks right).

![Various Conjugate Networks](MT_JPG/variousConjugateNetworks.jpg){#fig:conjugateNetworks}

### Planar Quads Perturbation

* Quad mesh as input with vertices $\mathbf{v}{_i}{_,}{_j}$

* minimally perturb the vertices into a new positions while maintaining the PQ meshes properties.

    
* Penalty Linear fonctunality combination:

1. $Q{_i}{_,}{_j}$ is convex and planar if and only if the sum of angles is equals to $2\pi$:


    $$c{_p}{_q}=\phi{^1}{_i}{_,}{_j}+ ... + \phi{^4}{_i}{_,}{_j} - 2\pi = 0.$$ {#eq:angles}

    Another Planarity Constraints on all the $\mathbf{v}\scriptsize{i,j}$, while computing the unit vectors along the egdes of each face consider the determinant on each edge equals to zero: $\mathbf{\lambda}{^T}{_d}{_e}{_t}c{_d}{_e}{_t}=0.$

2. Two energies terms:

    * Fairness (which simplifies the bending energies in the rows and columns on each polygon of the mesh):
    
    $$f{_f}{_a}{_i}{_r} = {\large{\sum}}{_i}{_,}{_j}{\large{[(}}{\mathbf{v}}{_i}{_+}{_1}{_,}{_j} - 2 {\mathbf{v}}{_i}{_,}{_j} + {\mathbf{v}}{_i}{_-}{_1}{_j}{\large{)}}{^2} + {\large{(}}{\mathbf{v}}{_i}{_,}{_j}{_+}{_1} - 2 {\mathbf{v}}{_i}{_,}{_j} + {\mathbf{v}}{_i}{_,}{_j}{_-}{_1}{\large{)}}{^2}{\large{]}}.$$


    * Closeness:

        While the polygons are defined as squares, this fonction minimizes the distance between the original surface $\Phi$ and the vertices $\mathbf{v}\scriptsize{i,j}$ of the perturbed mesh, where ${\mathbf{y}}{\scriptsize{i,j}}.$ are the closest points to the mesh, otherwise the undifined squares are set to zero :

        $$f{_c}{_l}{_o}{_s}{_e} = {\large{\sum}}{_i}{_,}{_j} ||{\mathbf{v}}{_i}{_,}{_j} - {\mathbf{y}}{_i}{_,}{_j}||{^2}.$$ 

3. SQP(Sequential Quadratic Programming)

    As subject to the constraints above the Langrangian functions is written as follow:
    
    $$f{_P}{_Q}=w{_1}f{_f}{_a}{_i}{_r}+w{_2}f{_c}{_l}{_o}{_s}{_e}+\mathbf{\lambda}{^T}{_p}{_q}c{_p}{_q}+\mathbf{\lambda}{^T}{_d}{_e}{_t}c{_d}{_e}{_t}$${#eq:langrangian}
    The SQP minimizes the fairness and closeness subject to the planarity constraints of $f{_P}{_Q}$. While $w{_1}$ and $w{_2}$ are user spicified constants to control fairness and closeness.

    SQP works only for up to 1000 vertices per mesh

    
    
4. Therefore another function by combining the constraints in {@eq:angles} by summing up the angles on all the polygons. In addition to that a final function is added to minimize the objectives in {@eq:langrangian}.


### Subdivisions

Using a quad based subdivision algorithm such as Catmull-Clark and Doo-Sabin[@. after subdividing the corse mesh, another PQ perturbation is made as seen in [@fig:subdivided]

![Coarse Mesh Subdivision and PQ perturbation sequence](MT_JPG/subdivision.jpg){#fig:subdivided}

### Generation of Conical Meshes

 * Principal Curves Computation

 ![Prinicpal curves computed with different kernel radii](MT_JPG/Principale curves.jpg){#fig:PrincipaleCurves}


 * Conical and circular optimization

 ![Conical mesh after combining a Catmull-Clark subdivision and a conical optimization](MT_JPG/conical mesh.jpg){#fig:optimConMesh}

>$$\omega_{1}+\omega_{3}-\omega_{2}-\omega_{4}=0.$${#eq:ang}$$\phi{^1}_{i,j}+\phi{^3}_{i,j}-\pi=0,\phi{^2}_{i,j}+\phi{^4}_{i,j}-\pi=0.$${#eq:planConAng}

![Circular Mesh generated after optimizing a conical mesh generated from principal curvature](MT_JPG/Circular mesh.jpg){#fig:CircularMesh}

## Planar Quads by Conjugate Direction Field(CDF):

* The advantage of designing a conjugate direction field is that the user's pocess a free control on the PQ mesh layout.

* The main challenge of a CDF is how to define a correct smoothness measure to allow $\pm k/4$.


### What is a CDF on a Triangular Mesh, [@liu2011general]

On a smooth surface  $S \subset {\Bbb R}{^3},$ the tangent vectors $\mathbf{v}{_p},\mathbf{w}{_p}$ are conjugate if and only if they are treated as two vectors in ${\Bbb R}{^3}$, where:

* the bilinear form $\mathbf{II}_{p}(\mathbf{v}_{p},\mathbf{w}_{p})=0$, $\mathbf{II}_{p}$ is the second fondamental form at $p$:

>$$K_{p,1}(\mathbf{v}_{p}.e_{p,1})(\mathbf{w}_{p}.e_{p,1})+K_{p,2}(\mathbf{v}_{p}.e_{p,2})(\mathbf{w}_{p}.e_{p,2})=0.$$ {#eq:2ndFond}

* $K_{p,1}$ and $K_{p,2}$ are the principale curvature at $p$,
* $e_{p,1}$ and $e_{p,2}$ are the corresponding principale directions.

On a triangular face $f{_i}$ as seen in [@fig:singleCDF] of a triangular mesh ${\Bbb R}{^3}=(V,E,F)$ a CDF is:

* Four vectors {$\mathbf{{v}_{i},{w}_{i}.{-v}_{i}{-w}_{i}}$}
* Two scalar parameters {$\theta_{i},\alpha_{i}$}:
    * $\theta_{i}$ oriented angle between $e_{i,1}$ and $\mathbf{v_{i}}$
    * $\alpha_{i}$ oriented angle between $\mathbf{v_{i}}$ and $\mathbf{w_{i}}$
    * They define the following: $\mathbf{{v_{i}}=(cos\theta_{i},sin\theta_{i})}{^T}$ and $\mathbf{w_{i}=(cos(\theta_{i}+\alpha_{i}),sin(\theta_{i}+\alpha_{i})}{^T}$

![CDF on a Triangular face](MT_JPG\Conjugate directions on a triangular Face.jpg){#fig:singleCDF}


### Types of CDF suited for PQ meshes:

#### Principale directions,

#### N-Rosy Field,

##### What is an N-Rosy Field?

* N-Rosy Field represents N coupled which don't change under rotations of an integer multiple of $\frac{2\pi}{2}$.
* The algorithm is able to handle the vector association to model fractional singularities.

###### Smoothness method,

* Signed permutation matrix: which randomize the vectors association between neighboring faces.
* Parallel transport

###### Index of Singularities,

#### Fields of Transverse Conjugates Directions(TCD),



#### Statics and Stress Mapping Fields.



### Algorithms for Generating a Quad-Dominant Mesh from a CDF:



#### Level Set Method,



##### What is a level Set Method and why?



#### Golbal parametrization,



### Quad Optimization for Planarity.


# Planar Quads Processing Goals:

## Convexity and Planarity

![Planarity measure](MT_JPG\Planarity measure.jpg){#fig:PlanarityMeasure}

According to [@liu2006geometric] a panel is flat and convex if and only if the difference between the sum of the internal angles and $2\pi$ should be zero therefore we assume the measure function as:

>$$\delta_{PQ}=\large{\sum_{\alpha_{i}}} -2\pi$$

## Warping Angle Ratio [@gokhale2008practical]

![Warping angle check [@GEOMCHECK]](MT_JPG\warpingangles.jpg){#fig:WarpingAngles}

Max element corner normal angular deviation from normal of mean plane

>$$PQ_{warping}=\max{|\mathbf{v}_{i,j}| \perp \mathbf{n}_{i}}=0$$

## Taper Ratio [@gokhale2008practical]

![Taper ratio check [@GEOMCHECK]](MT_JPG\Taper Ratio.jpg){#fig:TaperRatio}

Ideal value = 0 (acceptable < 0.5)

>$$PQ_{taper}=2\times\frac{{A}_{tri}}{{A}_{quad}\small{^-1}}$$


## Skew ratio [@gokhale2008practical]

![Skewness on a quad face](MT_JPG\Skew.jpg){#fig:Skewness}

$PQ_{skew}$ is the angle difference between $2\pi$ and the smallest angle formed by the two lines joining the center of the opposite side segments.

Ideal value = 0 (Acceptable < 45). 

>$$PQ_{skew} = 1 - (\frac{|\frac{\pi}{2} - \min(\alpha)|}{\frac{\pi}{2}})$$


## Size Change Ratio

The area on each quad is divided by two

>$$PQ_{area}=\frac{\max(d)_{PQ}\times{\min(d)_{PQ}}}{2}$$

## Diagonals Aspect Ratio 

![Diagonals ratio check](MT_JPG\Diagonal Aspect Ratio.jpg){#fig:DiagonalsAspectRatio}

Maximum distance between diagonals of the quad face divided by the min distance of diagonals,


>$$\eta_{PQ}=\frac{\max(d)_{PQ}}{\min(d)_{PQ}}$$

Ideal value = 1 (Acceptable < 5). [@gokhale2008practical]

# Results

# Comparison & Synthesis

# Conclusion

# References